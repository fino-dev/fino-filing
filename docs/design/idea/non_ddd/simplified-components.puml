@startuml fino-filing - Simplified Components
title fino-filing - Simplified Architecture (DDD concepts removed)

!include <C4/C4_Container>
!include <C4/C4_Component>

Person(user, "User")

System_Boundary(system, "fino-filing") {

    Boundary(services, "Services") {
        Component(edinet_service, "EdinetService", "ビジネスロジック")
        Component(collection_service, "Coll∂ectionService", "コレクション管理")
    }

    Boundary(repositories, "Repositories") {
        Component(filing_repo, "FilingRepository", "データアクセス")
        Component(edinet_client, "EdinetClient", "API通信")
        Component(file_storage, "FileStorage", "ファイル操作")
        Component(metadata_store, "MetadataStore", "メタデータDB")
    }

    Boundary(models, "Models") {
        Component(filing_model, "Filing / FilingMetadata", "データ構造")
    }

    ' 外部システム
    Component_Ext(edinet_api, "Edinet API", "外部API")
    Component_Ext(storage_system, "File System / S3", "ストレージ")
    ComponentDb_Ext(database, "SQLite / Postgres", "データベース")

    ' User interactions
    Rel(user, edinet_service, "sync_catalog() / collect()")
    Rel(user, collection_service, "search() / get()")

    ' Service層の関係
    Rel(edinet_service, edinet_client, "fetch")
    Rel(edinet_service, filing_repo, "save")
    Rel(collection_service, filing_repo, "query")

    ' Repository層の関係
    Rel(filing_repo, file_storage, "ファイル操作")
    Rel(filing_repo, metadata_store, "メタデータ操作")
    Rel(edinet_client, edinet_api, "HTTP通信")

    ' Storage/DB
    Rel(file_storage, storage_system, "read/write")
    Rel(metadata_store, database, "query/insert")

    ' Models
    Rel(filing_repo, filing_model, "use")
    Rel(edinet_service, filing_model, "use")
    Rel(collection_service, filing_model, "use")
}

note right of services
  **Services**
  - ビジネスロジックを実装
  - ユーザーに公開するAPI
  - Repository経由でデータアクセス
end note

note right of repositories
  **Repositories**
  - データアクセスの責務
  - 具体的な実装クラス
  - インターフェースなし
end note

note right of models
  **Models**
  - シンプルなデータクラス
  - Pydantic BaseModel
  - バリデーション機能
end note

skinparam linetype ortho
@enduml
