@startuml fino-edinet-collector - Coding Level
title fino-edinet-collector - Class Diagram (Derived from Final Component Graph)

skinparam linetype ortho
skinparam classAttributeIconSize 0
skinparam packageStyle rectangle

' ========================
' Application Layer (Public API)
' ========================
package "application" {

  class Edinet {
    - adapter: EdinetAdapter
    - collection: Collection

    + sync_catalog() : None
    + collect(**conditions) : CollectResult
  }

  class Collection {
    - model: CollectionModel

    + search(**conditions) : list[Filing]
    + get(document_id: str) : Filing
    + all() : list[Filing]
  }
}

' ========================
' Domain Layer
' ========================
package "domain" {

  class CollectionModel {
    - storage: StorageAdapter
    - metadata: MetadataAdapter

    + add(filing: Filing) : None
    + search(**conditions) : list[Filing]
    + get(document_id: str) : Filing
    + all() : list[Filing]
  }

  class Filing {
    + document_id: str
    + edinet_code: str
    + filer_name: str
    + doc_type: str
    + submit_date: date
    + path: Path

    + open() : IO
    + extract() : list[Path]
    + is_archive() : bool
  }

  class CollectResult {
    + filings: list[Filing]
    + collection: Collection
  }
}

' ========================
' Adapters (Interfaces)
' ========================
package "adapters.interfaces" {

  interface EdinetAdapter {
    + fetch_catalog() : list[dict]
    + fetch_document(document_id: str) : bytes
  }

  interface StorageAdapter {
    + save(document_id: str, content: bytes) : Path
    + open(path: Path) : IO
  }

  interface MetadataAdapter {
    + save(filing: Filing) : None
    + search(**conditions) : list[Filing]
    + get(document_id: str) : Filing
  }
}

' ========================
' Adapters (Implementations)
' ========================
package "adapters.implementations" {

  class EdinetApiAdapter {
  }

  class LocalFileStorageAdapter {
  }

  class S3StorageAdapter {
  }

  class SQLiteMetadataAdapter {
  }

  class DynamoMetadataAdapter {
  }
}

' ========================
' Config
' ========================
package "config" {

  class EdinetConfig {
    + api_key: str
    + base_url: str
  }

  class StorageConfig {
    + type: str
    + root_path: Path
  }

  class MetadataConfig {
    + type: str
    + connection: str
  }
}

' ========================
' Relationships
' ========================

Edinet --> Collection
Edinet --> EdinetAdapter

Collection --> CollectionModel

CollectionModel --> StorageAdapter
CollectionModel --> MetadataAdapter

CollectResult --> Filing
CollectResult --> Collection

EdinetApiAdapter ..|> EdinetAdapter

LocalFileStorageAdapter ..|> StorageAdapter
S3StorageAdapter ..|> StorageAdapter

SQLiteMetadataAdapter ..|> MetadataAdapter
DynamoMetadataAdapter ..|> MetadataAdapter

MetadataAdapter --> Filing

Edinet --> EdinetConfig
CollectionModel --> StorageConfig
CollectionModel --> MetadataConfig

@enduml